---
title: "241 Final Project: Effect of Meditation on Blood Pressure"
author: "Erika Lawrence, Thong Bui, Matt Post"
output: html_document 
---
```{r}
library(data.table)
library(sandwich)
library(lmtest)
```

# Exploring data

```{r}
d <- fread("../data/meditation.csv")
str(d)
d <- data.table(d)
d2 <- d[ , .(Group, 
             is_online = ifelse(Online_in_person == 'O', 1, 0),
             B4_Med_BP_Sys,
             After_Med_BP_Sys,
             B4_color_BP_Sys,
             After_color_BP_Sys) ]
summary(d2)
#hist(d2$Group)
#hist(d2$is_online, breaks=30)
par(mfrow=c(2,2))
hist(d2$B4_Med_BP_Sys, breaks = 30)
hist(d2$After_Med_BP_Sys, breaks = 30)
hist(d2$B4_color_BP_Sys, breaks = 30)
hist(d2$After_color_BP_Sys, breaks = 30)

library(RColorBrewer)
#display.brewer.all()
cols<-brewer.pal(n=3,name="Set1")
# Note: Group 0 is treatment group!
cols_t1<-cols[d2$Group+1]
med_diff <- d2$After_Med_BP_Sys- d2$B4_Med_BP_Sys
color_diff <- d2$After_color_BP_Sys - d2$B4_color_BP_Sys
par(mfrow =c(1,2))
plot(d2$Group ~ med_diff , col=cols_t1, pch=16)
legend("center",legend=c("Group 0: meditation", "Group 1: coloring"), col=cols_t1, pch=16)
plot(d2$Group ~ color_diff , col=cols_t1, pch=16)
legend("center",legend=c("Group 0: meditation", "Group 1: coloring"), col=cols_t1, pch=16)

# Plot b4 vs after meditation for 2 groups
plot(After_Med_BP_Sys ~ B4_Med_BP_Sys, data=d2 , col=cols_t1, pch=16)
legend(x=110,y=133, legend=c("Group 0: meditation", "Group 1: coloring"), col=cols_t1, pch=16, xpd=TRUE)

# Plot b4 vs after coloring for 2 groups
plot(After_color_BP_Sys ~ B4_color_BP_Sys, data=d2 , col=cols_t1, pch=16)
legend(x=110,y=141, legend=c("Group 0: meditation", "Group 1: coloring"), col=cols_t1, pch=16, xpd=TRUE)

```

# Regression model within-person
Baseline/control is coloring

Meditation is treatment

```{r}

m <- lm(After_Med_BP_Sys ~ B4_Med_BP_Sys + Group + B4_Med_BP_Sys * Group, data=d2)
coeftest(m, vcovHC(m))

m2 <- lm(After_color_BP_Sys ~ B4_color_BP_Sys + Group + B4_color_BP_Sys * Group, data=d2)
coeftest(m2, vcovHC(m2))
